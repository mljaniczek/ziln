---
title: "ziln Workflow"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ziln-workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ziln)
library(igraph)
data("counts_el")
```

In this tutorial I demonstrate the utility of the package using the same real-world microbial data used in the Prost (2021) paper. As in the paper, I use data from 1135 stool samples and have filtered down to 565 microbial markers. 

```{r}
head(counts_el[,1:10])
```

Use the `infer_Z_mj()` function which accepts raw count matrix (of filtered/narrowed down variables). After assuming that the data follow the zero inflated normal distribution, estimate the empirical correlation matrix:  
```{r warning = FALSE}
Z_el <- infer_Z_mj(as.matrix(counts_el))


```

Next use the `compute_graph_ziln()` function which can use the neightborhood search (Meinshausen and Buhlmann) on the empirical correlation matrix. 
 The MB algorithm "solves a penalized pseudo-likelihood maximization problem". 

In the Prost paper they pre-specify 1200 edges so this is done here as well. 
Note this can be time consuming since it searches a grid, so I have loaded the computation. 

```{r}
# below takes a long time 
#graph.zi = compute_graph_ziln(Z_el, 1200)
load(here::here("data/graph_zi_lldeep.Rdata"))
```

Finally we use the `igraph::graph.adjacency()` function to create an `igraph` graph from the above adjacency matrix, then use the result to plot with `plot.igraph`.
```{r}
el_graph <- graph.adjacency(graph.zi, 
                            mode = "undirected",
                            weighted = T)

plot(el_graph, 
     multiplier = 15,
     vertex.size = 4,  
     #vertex.label.dist = 2 , 
     vertex.label.cex = 0.5,
     rescale = T,
     vertex.label = NA,
     layout = layout_with_fr)
```




